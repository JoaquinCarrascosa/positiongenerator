# positiongenerator
Módulos de Stata y SPSS para el armado de generador de posiciones a partir de datos de encuesta

Se presenta a continuación la sintaxis utilizada para construir el generador de posiciones en Stata y en SPSS, al utilizar funciones básicas, esta misma puede ser fácilmente adaptable a otros softwares/lenguajes comúnmente utilizados para análisis de según la necesidad. Si bien el generador de posiciones se encuentra estandarizado en sus aspectos centrales, cada cuestionario estructura la información de maneras distintas por lo que el uso de esta sintaxis en otras bases de datos necesitará adaptaciones según las necesidades del caso. Al final de las variables correspondientes al generador de posiciones también se incluyen algunos gráficos y cálculo de medidas estadísticas de las medidas de capital social.

This sintax module includes the code to build positin generator measures with Stata and SPPS. It can be easily adapted to other languages. The position generator is standardized in its main aspects but each survey structures data in different ways so the use of this code might need some adaptations for each specific case.

Do-file STATA

/****Position generator measures of social capital***
*This do files converts dichotomous items from surveys into position generator
 measures for statistical analysis**
*do file for Stata, by Joaquín Carrascosa
Based on SPSS version by Martin van der Gaag
https://gaag.home.xs4all.nl/work/PGmeasuresSPSSsyntax.pdf
**/
/*
To cite this do-file: Carrascosa, J. (2021) Midiendo al capital social: aplicación del generador de posiciones en el Área Metropolitana de Buenos Aires
*/
* Example generated by -dataex-. To install: ssc install dataex
clear
input byte(falb aalb aadm fadm fop aop fger ager fmed amed fcom acom fab aab fdom adom)
0 0 0 0 0 1 0 0 0 1 1 0 1 0 0 0
0 1 0 0 0 0 0 0 0 0 0 0 0 0 1 1
0 0 0 1 1 0 0 0 1 0 0 0 1 1 0 0
0 1 0 1 0 0 1 0 0 0 1 0 0 1 0 0
1 1 0 1 0 0 1 0 0 0 0 0 0 0 0 0
0 0 1 1 0 1 1 0 1 0 0 0 0 1 0 1
0 0 1 1 1 0 1 0 1 0 0 0 0 0 0 1
0 0 0 0 1 1 0 0 0 0 1 0 0 0 0 0
0 1 1 0 0 1 0 1 0 1 1 1 1 1 0 0
0 0 1 1 0 0 0 0 0 0 0 0 1 1 0 0
1 1 1 0 1 1 0 0 0 0 0 1 0 0 1 1
0 1 0 0 0 0 0 0 0 0 0 1 0 0 1 0
1 1 1 1 1 1 0 0 0 0 1 0 1 0 1 0
1 1 0 0 1 0 0 0 0 0 0 0 0 0 1 1
0 1 1 0 1 1 0 1 1 1 0 1 0 0 0 1
0 0 1 1 1 0 0 1 0 0 1 0 0 0 1 0
1 1 1 1 1 1 0 0 1 0 1 1 0 0 1 1
0 1 1 0 0 0 0 1 0 1 0 1 0 1 0 0
0 1 0 1 0 1 0 0 0 0 0 0 0 1 0 0
0 0 0 1 0 0 1 0 1 0 0 0 1 0 0 0
0 0 1 1 0 1 0 0 0 0 0 1 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
end

**Create macro for variables**

global capsoc falb aalb aadm fadm fop aop fger ager fmed amed fcom acom fab aab fdom adom

*Label variables*
*alb = stonemason; adm = office worker; op = factory worker; ger = manager/CEO;
* med = doctor; com = shopowner; ab =lawyer; dom = house cleaner*
*a = friendships or aquaintances // f = family members*
*1 = has tie // 0 = doesnt have tie*

label def vcat 1 "Yes", modify
label def vcat 0 "No", modify

label values $capsoc vcat

foreach x of varlist falb fadm   fop  fger  fmed  fcom  fab  fdom{
	lab variable `x'  "Do you have a family member that works as a.."
	}	

foreach x of varlist aalb aadm   aop  ager  amed  acom  aab  adom{
	lab variable `x'  "Do you have a friend or aquaintance that works as a.."
	}	
**Generate variables reducing weak and strong ties to single variable (has tie or doesnt have tie),
 *this might not be neccesary if you alredy have a single tie variable*

gen alb=0
replace alb=1 if aalb==1 | falb==1

*Check*
tab aalb falb

gen adm=0
replace adm=1 if aadm==1 | fadm==1

gen op=0
replace op=1 if aop==1 | fop==1

gen ger=0
replace ger=1 if ager==1 | fger==1

gen med=0
replace med=1 if amed==1 | fmed==1

gen com=0
replace com=1 if acom==1 | fcom==1

gen ab=0
replace ab=1 if aab==1 | fab==1

gen dom=0
replace dom=1 if adom==1 | fdom==1

***Position generator variables***
*Number of contacts**

gen contacts=alb+adm+op+ger+med+com+ab+dom

***Recode binary variables to status values for each occupation using ISEI**
**See codes in: http://www.harryganzeboom.nl*

recode alb (1= 22) (.=0)
recode adm (1 =43) (.=0)
recode ger (1 =72) (.=0)
recode op (1 =23) (.=0)
recode med (1 = 88) (.=0)
recode com (1 = 35) (.=0)
recode ab (1 =86) (.=0)
recode dom (1 = 14) (.=0)

*Total social capital (adds up all the variables, used mainly to calculate mean social capital)*
gen totalsc = alb+adm+op+ger+med+com+ab+dom

*Mean social capital (averages contat´s status with number of contacts)*
gen meansc =totalsc/contacts

*Maximum social capital, highest status of contacts (used mainly to calculate range)*

generate maxsc = max(alb, adm, op, ger, med, com, ab, dom)

*Minimum social capital, lowest status of contacts (used mainly to calculate range)*
*Set 0 to missing to calculate minimum*
recode alb (1= 22) (0=.)
recode adm (1 =43) (0=.)
recode ger (1 =72) (0=.)
recode op (1 =23) (0=.)
recode med (1 = 88) (0=.)
recode com (1 = 35) (0=.)
recode ab (1 =86) (0=.)
recode dom (1 = 14) (0=.)

generate minsc = min(alb, adm, op, ger, med, com, ab, dom)

*Range of social capital (difference between max and min) for respondets with at least 2 contacts*
gen rangesc=maxsc-minsc if contacts>=2

*Check correlations, include ISEI for respondent occupation if you have it*
corr contacts totalsc meansc maxsc minsc rangesc

*Check with histograms, should be close to normal distribution in stratified population*
histogram contacts
histogram totalsc

*It is also posible to create separate measures for weak  and strong ties  using similar sintax*
* It is also possible to create measures only for "middle class contacts" or "working class contacts*


*Principal component analysis and factor analysis using Contacts, Maximum SC and Range of SC*

pca contacts maxsc rangesc
screeplot, yline(1)
loadingplot
predict pc1
estat loadings
tabstat pc1 , statistics( mean min max  sd )

factortest contacts maxsc rangesc

factor contacts maxsc rangesc

Factor loadings (pattern matrix) and unique variances

*Composite measure (Weights used are values of factor1 for each varaible), this measure is the same as pc1*
gen comp=(contacts*0.517+maxsc*0.585+rangesc*0.624)/3
tabstat comp, statistics( mean min max sd )

*



Sintaxis SPSS


*Armado lazos familiares (fuertes), amigos (débiles) y total (combinación de ambos)¨*

RECODE v76a (1=1) (2=1) (12=1)  INTO p79a.
RECODE v77a (1=1) (2=1) (12=1)  INTO p80a.
RECODE v76a (3=0) (99=0)  INTO p79a.
RECODE v77a (3=0) (99=0)  INTO p80a.
IF (p79a = 1) OR (p80a = 1) p81a = 1.
IF (p79a = 0) AND (p80a = 0) p81a = 0.
VARIABLE LABELS  p79a 'AlbañilFuerte'.
VARIABLE LABELS  p80a 'AlbañilDebil'.
VARIABLE LABELS p81a "Albañil".

RECODE v76b (1=1) (2=1) (12=1)  INTO p79b.
RECODE v77b (1=1) (2=1) (12=1)  INTO p80b.
RECODE v76b (3=0) (99=0)  INTO p79b.
RECODE v77b (3=0) (99=0)  INTO p80b.
IF (p79b = 1) OR (p80b = 1) p81b = 1.
IF (p79b = 0) AND (p80b = 0) p81b = 0.
VARIABLE LABELS  p79b 'AdminFuerte'.
VARIABLE LABELS  p80b 'AdminDebil'.
VARIABLE LABELS p81b "Admin".


RECODE v76c (1=1) (2=1) (12=1)  INTO p79c.
RECODE v77c (1=1) (2=1) (12=1)  INTO p80c.
RECODE v76c (3=0) (99=0)  INTO p79c.
RECODE v77c (3=0) (99=0)  INTO p80c.
IF (p79c = 1) OR (p80c = 1) p81c = 1.
IF (p79c = 0) AND (p80c = 0) p81c = 0.
VARIABLE LABELS  p79c 'OpFuerte'.
VARIABLE LABELS  p80c 'OpDebil'.
VARIABLE LABELS p81c "Op".

RECODE v76d (1=1) (2=1) (12=1)  INTO p79d.
RECODE v77d (1=1) (2=1) (12=1)  INTO p80d.
RECODE v76d (3=0) (99=0)  INTO p79d.
RECODE v77d (3=0) (99=0)  INTO p80d.
IF (p79d = 1) OR (p80d = 1) p81d = 1.
IF (p79d = 0) AND (p80d = 0) p81d = 0.
VARIABLE LABELS  p79d 'GerFuerte'.
VARIABLE LABELS  p80d 'GerDebil'.
VARIABLE LABELS p81d "Ger".

RECODE v76e (1=1) (2=1) (12=1)  INTO p79e.
RECODE v77e (1=1) (2=1) (12=1)  INTO p80e.
RECODE v76e (3=0) (99=0)  INTO p79e.
RECODE v77e (3=0) (99=0)  INTO p80e.
IF (p79e = 1) OR (p80e = 1) p81e = 1.
IF (p79e = 0) AND (p80e = 0) p81e = 0.
VARIABLE LABELS  p79e 'MedFuerte'.
VARIABLE LABELS  p80e 'MedDebil'.
VARIABLE LABELS p81e "Med".

RECODE v76f (1=1) (2=1) (12=1)  INTO p79f.
RECODE v77f (1=1) (2=1) (12=1)  INTO p80f.
RECODE v76f (3=0) (99=0)  INTO p79f.
RECODE v77f (3=0) (99=0)  INTO p80f.
IF (p79f = 1) OR (p80f = 1) p81f = 1.
IF (p79f = 0) AND (p80f = 0) p81f = 0.
VARIABLE LABELS  p79f 'ComFurte'.
VARIABLE LABELS  p80f 'ComDebil'.
VARIABLE LABELS p81f  "Com".

RECODE v76g (1=1) (2=1) (12=1)  INTO p79g.
RECODE v77g (1=1) (2=1) (12=1)  INTO p80g.
RECODE v76g (3=0) (99=0)  INTO p79g.
RECODE v77g (3=0) (99=0)  INTO p80g.
IF (p79g = 1) OR (p80g = 1) p81g = 1.
IF (p79g = 0) AND (p80g = 0) p81g = 0.
VARIABLE LABELS  p79g 'AbFuerte'.
VARIABLE LABELS  p80g 'AbDebil'.
VARIABLE LABELS p81g  "Ab".

RECODE v76h (1=1) (2=1) (12=1)  INTO p79h.
RECODE v77h (1=1) (2=1) (12=1)  INTO p80h.
RECODE v76h (3=0) (99=0)  INTO p79h.
RECODE v77h (3=0) (99=0)  INTO p80h.
IF (p79h = 1) OR (p80h = 1) p81h = 1.
IF (p79h = 0) AND (p80h = 0) p81h = 0.
VARIABLE LABELS  p79h 'DomFuerte'.
VARIABLE LABELS  p80h 'DomDebil'.
VARIABLE LABELS p81h  "Dom".

*Computar ISEIs asignadas a cada ocupación*

COMPUTE AlbFuerte = p79a*22.57.
COMPUTE AlbDebil = p80a*22.57.
COMPUTE Alb = p81a*22.57.

COMPUTE AdmFuerte = p79b*43.33.
COMPUTE AdmDebil = p80b*43.33.
COMPUTE Adm = p81b*43.33.

COMPUTE OpFuerte = p79c*23.41.
COMPUTE OpDebil = p80c*23.41.
COMPUTE Op = p81c*23.41.

COMPUTE GerFuerte = p79d*72.94.
COMPUTE GerDebil = p80d*72.94.
COMPUTE Ger = p81d*72.94.

COMPUTE MedFuerte = p79e*88.70.
COMPUTE MedDebil = p80e*88.70.
COMPUTE Med = p81e*88.70.

COMPUTE ComFuerte = p79f*35.34.
COMPUTE ComDebil = p80f*35.34.
COMPUTE Com = p81f*35.34.

COMPUTE AbFuerte = p79g*86.72.
COMPUTE AbDebil = p80g*86.72.
COMPUTE Ab = p81g*86.72.

COMPUTE DomFuerte = p79h*14.21.
COMPUTE DomDebil = p80h*14.21.
COMPUTE Dom = p81h*14.21.

*Computar cantidad de contactos*

COMPUTE CantidadFuerte = p79a+p79b+p79c+p79d+p79e+p79f+p79g+p79h.
COMPUTE CantidadDebil = p80a+p80b+p80c+p80d+p80e+p80f+p80g+p80h.
COMPUTE Cantidad = p81a+p81b+p81c+p81d+p81e+p81f+p81g+p81h.

*Desactivar 0 para cálculo de Máximo, Minimo, Promedio, Rango*

RECODE AlbFuerte (0=SYSMIS).
RECODE AlbDebil (0=SYSMIS).
RECODE Alb (0=SYSMIS).

RECODE AdmFuerte (0=SYSMIS).
RECODE AdmDebil (0=SYSMIS).
RECODE Adm (0=SYSMIS).

RECODE OpFuerte (0=SYSMIS).
RECODE OpDebil (0=SYSMIS).
RECODE Op (0=SYSMIS).

RECODE GerFuerte (0=SYSMIS).
RECODE GerDebil (0=SYSMIS).
RECODE Ger (0=SYSMIS).
 
RECODE MedFuerte (0=SYSMIS).
RECODE MedDebil (0=SYSMIS).
RECODE Med (0=SYSMIS).
 
RECODE ComFuerte (0=SYSMIS).
RECODE ComDebil (0=SYSMIS).
RECODE Com (0=SYSMIS).
 
RECODE AbFuerte (0=SYSMIS).
RECODE AbDebil (0=SYSMIS).
RECODE Ab (0=SYSMIS).
 
RECODE DomFuerte (0=SYSMIS).
RECODE DomDebil (0=SYSMIS).
RECODE Dom (0=SYSMIS).
 
**CALCULAR MEDIDAS FUERTE**

COMPUTE PromedioFuerte =MEAN (AlbFuerte, AdmFuerte, OpFuerte, GerFuerte, MedFuerte, ComFuerte, AbFuerte, DomFuerte).

COMPUTE MaximoFuerte=MAX (AlbFuerte, AdmFuerte, OpFuerte, GerFuerte, MedFuerte, ComFuerte, AbFuerte, DomFuerte).

COMPUTE MinimoFuerte=MIN  (AlbFuerte, AdmFuerte, OpFuerte, GerFuerte, MedFuerte, ComFuerte, AbFuerte, DomFuerte).

IF  (CantidadFuerte  >  1) RangoFuerte=MaximoFuerte - MinimoFuerte.

COMPUTE TotalFuerte= SUM (AlbFuerte, AdmFuerte, OpFuerte, GerFuerte, MedFuerte, ComFuerte, AbFuerte, DomFuerte).

**CALCULAR MEDIDAS DÉBIL**

COMPUTE PromedioDebil =MEAN (AlbDebil, AdmDebil, OpDebil, GerDebil, MedDebil, ComDebil, AbDebil, DomDebil).

COMPUTE MaximoDebil=MAX (AlbDebil, AdmDebil, OpDebil, GerDebil, MedDebil, ComDebil, AbDebil, DomDebil).

COMPUTE MinimoDebil=MIN  (AlbDebil, AdmDebil, OpDebil, GerDebil, MedDebil, ComDebil, AbDebil, DomDebil).

IF  (CantidadDebil   >  1) RangoDebil=MaximoDebil - MinimoDebil.

COMPUTE TotalDebil= SUM (AlbDebil, AdmDebil, OpDebil, GerDebil, MedDebil, ComDebil, AbDebil, DomDebil).

**CALCULAR MEDIDAS TOTALES**
COMPUTE Promedio =MEAN (Alb, Adm, Op, Ger, Med, Com, Ab, Dom).

COMPUTE Maximo=MAX  (Alb, Adm, Op, Ger, Med, Com, Ab, Dom).

COMPUTE Minimo=MIN  (Alb, Adm, Op, Ger, Med, Com, Ab, Dom).

IF  (Cantidad   >  1) Rango=Maximo - Minimo.

COMPUTE Total= SUM  (Alb, Adm, Op, Ger, Med, Com, Ab, Dom).

RECODE AlbFuerte, AdmFuerte, OpFuerte, GerFuerte, MedFuerte, ComFuerte, AbFuerte, DomFuerte AlbDebil, AdmDebil, OpDebil, GerDebil, MedDebil, ComDebil, AbDebil, DomDebil, Alb, Adm, Op, Ger, Med, Com, Ab, Dom (SYSMIS = 0).

GRAPH
/HISTOGRAM= Cantidad.
GRAPH
/HISTOGRAM= CantidadFuerte.
GRAPH
/HISTOGRAM= CantidadDebil.
GRAPH
/HISTOGRAM= Promedio.
GRAPH
/HISTOGRAM= Rango.
GRAPH
/HISTOGRAM= Total.

FREQUENCIES VARIABLES=p79a p80a p81a p79b p80b p81b p79c p80c p81c p79d p80d p81d p79e p80e p81e 
    p79f p80f p81f p79g p80g p81g p79h p80h p81h Cantidad CantidadFuerte CantidadDebil
  /ORDER=ANALYSIS.

DESCRIPTIVES VARIABLES=Cantidad CantidadFuerte CantidadDebil Promedio Rango Maximo Total TotalFuerte TotalDebil
  /STATISTICS=MEAN STDDEV VARIANCE MIN MAX KURTOSIS SKEWNESS.
